var PodsUI=function(){"use strict";var e={};e["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var i='<div class="pods-ui-file-list"></div>\n<div class="pods-ui-region"></div>\n<div class="pods-ui-form"></div>\n',t=Backbone.Model.extend({defaults:{id:0,icon:"",name:"",link:""}}),l=Backbone.Collection.extend({model:t}),o='<input\n	name="<%- attr.name %>[<%- id %>][id]"\n	data-name-clean="<%- attr.name_clean %>-id"\n	id="<%- attr.id %>-<%- id %>-id"\n	class="<%- attr.class %>"\n	type="hidden"\n	value="<%- id %>" />\n<ul class="pods-flex-meta media-item">\n	<% if ( 1 != options.file_limit ) { %>\n		<li class="pods-flex-col pods-flex-handle">Handle</li>\n	<% } %>\n	<li class="pods-flex-col pods-flex-icon"><img class="pinkynail" src="<%- icon %>" alt="Icon"></li>\n	<li class="pods-flex-col pods-flex-name">\n		<% if ( 0 != options.file_edit_title ) { %>\n			<input\n				name="<%- attr.name %>[<%- id %>][title]"\n				data-name-clean="<%- attr.name_clean %>-title"\n				id="pods-form-ui-<%- attr.name_clean %>-<%- id %>-title"\n				class="pods-form-ui-field-type-text pods-form-ui-field-name-<%- attr.name_clean %>-title"\n				type="text"\n				value="<%- name %>"\n				tabindex="2"\n				maxlength="255" />\n		<% } else { %>\n			<%- name %>\n		<% } %>\n	</li>\n	<li class="pods-flex-col pods-flex-remove"><a href="#remove">Remove</a></li>\n	<% if ( 0 != options.file_linked ) { %>\n		<li class="pods-flex-col pods-flex-download"><a href="<%- link %>" target="_blank">Download</a></li>\n	<% } %>\n</ul>\n',n=Mn.CollectionView.extend({initialize:function(e){this.fieldModel=e.fieldModel,this.childViewOptions={fieldModel:e.fieldModel}}}),s=Mn.LayoutView.extend({serializeData:function(){var e=this.options.fieldModel,i=this.model?this.model.toJSON():{};return i.field_type=e.get("type"),i.attr=e.get("attributes"),i.options=e.get("options"),i}}),d=s.extend({tagName:"li",className:"pods-flex-item",ui:{dragHandle:".pods-flex-handle",downloadLink:".pods-flex-download",removeButton:".pods-flex-remove"},template:_.template(o),triggers:{"click @ui.removeButton":"remove:file:click"}}),a=n.extend({tagName:"ul",className:"pods-flex-list",childView:d,onAttach:function(){var e=this.options.fieldModel.get("options");if(1!=e.file_limit){var i="y";"tiles"==e.file_field_template&&(i=""),this.$el.sortable({containment:"parent",axis:i,scrollSensitivity:40,tolerance:"pointer",opacity:.6})}}}),c='<a class="button pods-flex-add" href="#" tabindex="2"><%= options.file_add_button %></a>',r=s.extend({tagName:"div",ui:{addButton:".pods-flex-add"},template:_.template(c),triggers:{"click @ui.addButton":"add:file:click"}}),p=Mn.Object.extend({constructor:function(e){this.browseButton=e.browseButton,this.uiRegion=e.uiRegion,this.fieldOptions=e.fieldOptions,Mn.Object.call(this,e)}}),f='<ul class="pods-flex-meta media-item">\n	<% if ( \'\' === errorMsg ) { %>\n		<li class="pods-flex-col pods-progress"><div class="progress-bar" style="width: <%- progress %>%;"></div></li>\n	<% } %>\n	<li class="pods-flex-col pods-flex-name"><%- filename %></li>\n</ul>\n<% if ( \'\' !== errorMsg ) { %>\n	<div class="error"><%- errorMsg %></div>\n<% } %>\n',u=Backbone.Model.extend({defaults:{id:0,filename:"",progress:0,errorMsg:""}}),m=Mn.LayoutView.extend({model:u,tagName:"li",template:_.template(f),attributes:function(){return{"class":"pods-flex-item",id:this.model.get("id")}},modelEvents:{change:"onModelChanged"},onModelChanged:function(){this.render()}}),h=Mn.CollectionView.extend({tagName:"ul",className:"pods-flex-list pods-flex-queue",childView:m}),g=Object.freeze({FileUploadQueueModel:u,FileUploadQueueItem:m,FileUploadQueue:h}),w=p.extend({plupload:{},fileUploader:"plupload",initialize:function(){this.fieldOptions.plupload_init.browse_button=this.browseButton,this.plupload=new plupload.Uploader(this.fieldOptions.plupload_init),this.plupload.init(),this.plupload.bind("FilesAdded",this.onFilesAdded,this),this.plupload.bind("UploadProgress",this.onUploadProgress,this),this.plupload.bind("FileUploaded",this.onFileUploaded,this)},onFilesAdded:function(e,i){var t=void 0,l=void 0,o=void 0;l=new Backbone.Collection,jQuery.each(i,function(e,i){t=new u({id:i.id,filename:i.name}),l.add(t)}),o=new h({collection:l}),o.render(),this.uiRegion.reset(),this.uiRegion.show(o),this.queueCollection=l,e.refresh(),e.start()},onUploadProgress:function(e,i){var t=this.queueCollection.get(i.id);t.set({progress:i.percent})},onFileUploaded:function(i,t,l){var o=this.queueCollection.get(t.id),n=l.response,s=[];if("Error: "==l.response.substr(0,7))n=n.substr(7),window.console&&console.log(n),o.set({progress:0,errorMsg:n});else if("<e>"==l.response.substr(0,3))n=jQuery(n).text(),window.console&&console.log(n),o.set({progress:0,errorMsg:n});else{var d=n.match(/{.*}$/);if(d=null!==d&&0<d.length?jQuery.parseJSON(d[0]):{},"object"!=("undefined"==typeof d?"undefined":e["typeof"](d))||jQuery.isEmptyObject(d))return window.console&&console.log(n),window.console&&console.log(d),void o.set({progress:0,errorMsg:"There was an issue with the file upload, please try again."});s={id:d.ID,icon:d.thumbnail,name:d.post_title,link:d.link},o.trigger("destroy",o),this.trigger("added:files",s)}},invoke:function(){}}),v=p.extend({mediaObject:{},fileUploader:"attachment",invoke:function(){void 0===wp.Uploader.defaults.filters.mime_types&&(wp.Uploader.defaults.filters.mime_types=[{title:"Allowed Files",extensions:"*"}]);var e=wp.Uploader.defaults.filters.mime_types[0].extensions;wp.Uploader.defaults.filters.mime_types[0].extensions=this.fieldOptions.limit_extensions,this.mediaObject=wp.media({title:this.fieldOptions.file_modal_title,multiple:1!=this.fieldOptions.file_limit,library:{type:this.fieldOptions.limit_types},button:{text:this.fieldOptions.file_modal_add_button}}),this.mediaObject.once("select",this.onMediaSelect,this),this.mediaObject.open(),this.mediaObject.content.mode(this.fieldOptions.file_attachment_tab),wp.Uploader.defaults.filters.mime_types[0].extensions=e},onMediaSelect:function(){var e=this.mediaObject.state().get("selection"),i=[];e&&(e.each(function(e){var t=e.attributes.sizes,l=void 0;l=e.attributes.icon,void 0!==t&&(void 0!==t.thumbnail&&void 0!==t.thumbnail.url?l=t.thumbnail.url:void 0!==t.full&&void 0!==t.full.url&&(l=t.full.url)),i.push({id:e.attributes.id,icon:l,name:e.attributes.title,link:e.attributes.url})}),this.trigger("added:files",i))}}),x=[w,v],b=0,y=Mn.LayoutView.extend({template:_.template(i),regions:{list:".pods-ui-file-list",uiRegion:".pods-ui-region",form:".pods-ui-form"},uploader:{},onRender:function(){var e=new a({collection:this.collection,fieldModel:this.model}),i=new r({fieldModel:this.model});this.showChildView("list",e),this.showChildView("form",i),this.uploader=this.createUploader(),this.listenTo(this.uploader,"added:files",this.onAddedFiles)},onChildviewRemoveFileClick:function(e){this.collection.remove(e.model)},onChildviewAddFileClick:function(){this.uploader.invoke()},onAddedFiles:function(e){var i=this.model.get("options"),t=+i.file_limit,l=void 0,o=void 0;l=this.collection.clone(),l.add(e),o=b===t?l.models:l.filter(function(e){return l.indexOf(e)>=l.length-t}),this.collection.reset(o)},createUploader:function(){var e=this.model.get("options"),i=e.file_uploader,t=void 0;if(jQuery.each(x,function(e,l){return i===l.prototype.fileUploader?(t=l,!1):void 0}),void 0!==t)return this.uploader=new t({browseButton:this.getRegion("form").getEl(".pods-flex-add").get(),uiRegion:this.getRegion("uiRegion"),fieldOptions:e}),this.uploader;throw"Could not locate file uploader '"+i+"'"}}),k='<div class="view-selector"></div>\n<div class="pods-pick-values"></div>\n<div class="pods-ui-add-new"></div>',M=wp.media.view.Frame.extend({className:"pods-modal-frame",template:_.template('<div class="media-frame-title" /><div class="media-frame-iframe" />'),regions:["title","iframe"],initialize:function(){wp.media.view.Frame.prototype.initialize.apply(this,arguments),this.$el.addClass("wp-core-ui"),this.initState(),this.initModal(),this.on("iframe:create:default",this.iframeContent,this),this.iframe.mode("default"),this.on("title:create:default",this.createTitle,this),this.title.mode("default"),this.on("title:render",function(e){e.$el.append('<span class="dashicons dashicons-arrow-down"></span>')})},initState:function(){var e=this.options.title||"Add New Record",i=this.options.src||"/";this.states.add([new wp.media.controller.State({id:"default",title:e,src:i})]),this.options.state="default"},initModal:function(){this.modal=new wp.media.view.Modal({controller:this}),this.modal.content(this)},render:function(){return!this.state()&&this.options.state&&this.setState(this.options.state),wp.media.view.Frame.prototype.render.apply(this,arguments)},iframeContent:function(e){e.view=new wp.media.view.Iframe({controller:this})},createTitle:function(e){e.view=new wp.media.View({controller:this,tagName:"h1"})}}),C='<span class="checkbox" style="background-color: #c7def8; display: inline-block; padding: 5px 10px; margin: 10px 0; border-radius: 4px; cursor: pointer;">\n	Checkbox\n</span>\n<span class="select" style="background-color: #c7def8; display: inline-block; padding: 5px 10px; margin: 10px 0; border-radius: 4px; cursor: pointer;">\n	Select\n</span>\n<span class="flex" style="background-color: #c7def8; display: inline-block; padding: 5px 10px; margin: 10px 0; border-radius: 4px; cursor: pointer;">\n	Flex\n</span>',N=Mn.LayoutView.extend({template:_.template(C),ui:{checkbox:".checkbox",select:".select",flex:".flex"},triggers:{"click @ui.checkbox":"checkbox:view:click","click @ui.select":"select:view:click","click @ui.flex":"flex:view:click"}}),O='<div class="pods-field pods-boolean">\n	<input\n		name="<%- attr.name %>[<%= ordinal %>]"\n		<%= selected ? \'checked="checked"\' : \'\' %>\n		data-name-clean="<%- attr.name_clean %>"\n		data-label="<%- options.label %>"\n		id="<%- attr.id %><%= ordinal %>"\n		class="pods-form-ui-field-type-pick"\n		type="checkbox" tabindex="2" value="<%- id %>">\n	<label class="pods-form-ui-label" for="<%- attr.id %><%= ordinal %>">\n		<%= name %>\n	</label>\n</div>\n',S=s.extend({tagName:"li",template:_.template(O),className:"pods-pick",ui:{checkbox:"input.pods-form-ui-field-type-pick"},triggers:{"click @ui.checkbox":"toggle:selected"},modelEvents:{change:"modelChanged"},templateHelpers:function(){return{ordinal:this.model.collection.indexOf(this.model)}},modelChanged:function(){this.render()},onToggleSelected:function(){this.model.toggleSelected()}}),j=n.extend({tagName:"ul",className:"pods-checkbox-view",childView:S}),V=s.extend({tagName:"option",template:!1,initialize:function(){this.$el.val(this.model.get("id")),this.$el.html(this.model.get("name")),this.model.get("selected")&&this.$el.prop("selected","selected")}}),F=n.extend({tagName:"select",childView:V,triggers:{change:"change:selected"},attributes:function(){var e=this.options.fieldModel,i=e.get("attributes"),t=e.get("options");return{name:i.name+"[]","class":i["class"],"data-name-clean":i.name_clean,id:i.id,tabindex:"2",multiple:t.pick_format_type}},onChangeSelected:function(){this.collection.setSelected(this.$el.val())}}),U='<input name="pods_meta_file_test[<%- attr.id %>][attr.id]"\n		data-name-clean="pods-meta-file-test-id-id"\n		id="pods-form-ui-pods-meta-file-test-id-id"\n		class="pods-form-ui-field-type-text pods-form-ui-field-name-pods-meta-file-test-id-id"\n		type="hidden"\n		value="<%- attr.id %>>">\n<ul class="pods-flex-meta relationship-item">\n	<li class="pods-flex-col pods-flex-handle">Handle</li>\n	<% if ( icon != \'\' ) { %>\n		<li class="pods-flex-col pods-flex-icon">\n			<img class="pinkynail" src="<%- icon %>" alt="Icon">\n		</li>\n	<% } %>\n	<li class="pods-flex-col pods-flex-name">\n		<input name="pods_meta_file_test[<%- attr.id %>][title]"\n				data-name-clean="pods-meta-file-test-id-title"\n				id="pods-form-ui-pods-meta-file-test-id-title"\n				class="pods-form-ui-field-type-text pods-form-ui-field-name-pods-meta-file-test-id-title"\n				type="text"\n				value="<%= name %>"\n				tabindex="2"\n				maxlength="255">\n	</li>\n	<li class="pods-flex-col pods-flex-remove">\n		<a href="#remove">Remove</a>\n	</li>\n</ul>\n',B=s.extend({tagName:"li",className:"pods-flex-item pods-relationship",template:_.template(U),events:{"click .pods-flex-remove a":"delete_item_click"},delete_item_click:function(e){e.preventDefault(),this.model.toggle_selected()}}),Q=n.extend({tagName:"ul",className:"pods-flex-list pods-relationship",childView:B}),R='<a href="/wp-admin/?pods_modal=1"\n		class="button pods-related-add-new pods-modal"\n		data-pod-id="<%- options.pod_id %>"\n		data-field-id="<%- options.id %>"\n		data-item-id="<%- options.item_id %>">\n	Add New\n</a>',A=s.extend({tagName:"div",className:"podsform-flex-relationship-container",ui:{addButton:".pods-related-add-new"},template:_.template(R),triggers:{"click @ui.addButton":"add:new:click"}}),z=Mn.LayoutView.extend({template:_.template(k),regions:{viewSelector:".view-selector",list:".pods-pick-values",addNew:".pods-ui-add-new"},onRender:function(){var e=new j({collection:this.collection,fieldModel:this.model}),i=new A({fieldModel:this.model});this.showChildView("viewSelector",new N({})),this.showChildView("list",e),this.showChildView("addNew",i)},onChildviewAddNewClick:function(e){var i=this.model.get("options"),t=new M({title:"The Title",src:i.iframe_src});t.modal.open()},addNewSuccess:function(e){console.log(e)},onChildviewCheckboxViewClick:function(e){var i=new j({collection:this.collection,fieldModel:this.model});this.showChildView("list",i)},onChildviewSelectViewClick:function(e){var i=new F({collection:this.collection,fieldModel:this.model});this.showChildView("list",i)},onChildviewFlexViewClick:function(e){var i=new Q({collection:this.collection,fieldModel:this.model});this.showChildView("list",i)}}),I=Object.freeze({FileUpload:y,Pick:z}),$=Backbone.Model.extend({defaults:{type:"hidden",attributes:{},options:{}}}),T=Backbone.Model.extend({defaults:{id:0,name:"",icon:"",selected:!1},toggleSelected:function(){this.set("selected",!this.get("selected"))}}),L=Backbone.Collection.extend({model:T,setSelected:function(e){this.map(function(i){var t=_.contains(e,i.get("id")+"");i.set("selected",t)})},filterSelected:function(){var e=this.filter(function(e){return e.get("selected")});return new L(e)}}),E=function(e){var i={};switch(e){case"file-upload":i.control=y,i.collection=l;break;case"pick":i.control=z,i.collection=L}return i},P=function(e){return this.each(function(){var i={},t=void 0,l=void 0,o=void 0,n=void 0;jQuery(this).find("script.data").each(function(){var e=jQuery.parseJSON(jQuery(this).html());jQuery.extend(i,e),jQuery(this).remove()}),void 0!==i.field_type&&(o=E(i.field_type),void 0!==o.control&&(t=new $({type:i.field_type,attributes:i.field_meta.field_attributes,options:i.field_meta.field_options}),l=i.field_meta.field_attributes.id,n=new o.control({el:this,model:t,collection:new o.collection(i.model_data)}),n.render(),e[l]=n))})},q={fieldClasses:I,fields:{},Queue:g};return jQuery.fn.podsFieldsInit=P,jQuery(function(){jQuery(".pods-form-ui-field").podsFieldsInit(q.fields)}),q}();